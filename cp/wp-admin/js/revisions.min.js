document.addEventListener("DOMContentLoaded",(function(){var e,t,n={},a=document.querySelector(".revisions"),r=document.querySelector(".from-slider-wrapper"),i=document.getElementById("from-slider"),o=document.getElementById("to-slider"),s=document.querySelector(".revisions-previous .button"),l=document.querySelector(".revisions-next .button"),d=document.querySelectorAll("#ticks option"),u=document.getElementById("revisions-list").value.split(", "),c=document.querySelector(".diff-meta-from .author-card"),v=document.querySelector(".diff-meta-to .author-card"),p=document.querySelector(".diff"),f=new URLSearchParams(window.location.search),m=document.getElementById("compare-two-revisions");function g(e){n.hasOwnProperty(e)?(c.innerHTML=n[e].author_left,v.innerHTML=n[e].author_right,p.innerHTML=n[e].diffs):h(e)}function h(e){var t=e.split(":"),a=new FormData;if("0"===t[0]){for(let e=u.length-2;e>=0;e--)a.append("compare[]",u[e]+":"+u[e+1]);a.append("compare[]","0:"+u[0])}else"undefined"===t[0]&&(e="0:"+t[1]),a.append("compare[]",e);a.append("action","get-revision-diffs"),a.append("post_id",_wpRevisionsSettings.postId),fetch(ajaxurl,{method:"POST",body:a,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(a){var r=e;Object.assign(n,a.data),"0"===t[0]&&u[u.indexOf(t[1])-1]!==undefined&&(r=u[u.indexOf(t[1])-1]+":"+t[1]),c.innerHTML=n[r].author_left,v.innerHTML=n[r].author_right,p.innerHTML=n[r].diffs}))["catch"]((function(e){console.error(_wpRevisionsSettings.error,e)}))}function y(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}f.has("from")?(m.checked=!0,r.style.display="inline",a.classList.add("comparing-two-revisions"),i.value=u.indexOf(f.get("from")),o.value=u.indexOf(f.get("to")),h(f.get("from")+":"+f.get("to"))):(r.style.display="none",a.classList.remove("comparing-two-revisions"),o.value=u.indexOf(f.get("revision")),0===parseInt(o.value,10)?s.disabled=!0:parseInt(o.value,10)===u.length-1&&(l.disabled=!0),h("0:"+f.get("revision"))),i.addEventListener("input",(function(){y(i)&&i.value>=o.value&&(i.value=parseInt(o.value,10)-1),e=y(i)?u[i.value]:u[0],t=u[o.value],g(e+":"+t),f["delete"]("revision"),f.set("from",e),f.set("to",t),history.pushState(null,null,"?"+f.toString())})),o.addEventListener("input",(function(){y(i)?(o.value<=i.value&&(o.value=parseInt(i.value,10)+1),e=u[i.value],t=u[o.value],f["delete"]("revision"),f.set("from",e),f.set("to",t)):(e=u[parseInt(o.value,10)-1],t=u[o.value],f["delete"]("from"),f["delete"]("to"),f.set("revision",t)),0===parseInt(o.value,10)?s.disabled=!0:s.disabled=!1,parseInt(o.value,10)===u.length-1?l.disabled=!0:l.disabled=!1,g(e+":"+t),history.pushState(null,null,"?"+f.toString())})),document.addEventListener("click",(function(e){e.target===s?(o.value=parseInt(o.value,10)-1,o.dispatchEvent(new Event("input")),0===parseInt(o.value,10)?s.disabled=!0:s.disabled=!1,l.disabled=!1):e.target===l?(o.value=parseInt(o.value,10)+1,o.dispatchEvent(new Event("input")),parseInt(o.value,10)===u.length-1?l.disabled=!0:l.disabled=!1,s.disabled=!1):e.target.className.includes("restore-revision")&&(document.location=e.target.dataset.restore)})),d.forEach((function(e){var t=document.getElementById("current-tooltip");e.addEventListener("mouseover",(function(){t.style.backgroundColor="#fff",t.innerHTML=e.dataset.tooltip.replace("{{",'<span style="color:#d63638">').replace("}}","</span>").replace("[[","<strong>").replace("]]","</strong><br>")})),e.addEventListener("mouseout",(function(){t.style.backgroundColor="transparent",t.innerHTML=""}))})),m.addEventListener("change",(function(e){e.target.checked?(r.style.display="inline",a.classList.add("comparing-two-revisions"),i.value>=o.value&&(i.value=parseInt(o.value,10)-1,i.dispatchEvent(new Event("input"))),0==o.value&&(i.value=0,i.dispatchEvent(new Event("input")),o.value=1,o.dispatchEvent(new Event("input"))),f["delete"]("revision"),f.set("from",u[i.value]),f.set("to",u[o.value]),history.replaceState(null,null,"?"+f.toString())):(r.style.display="none",a.classList.remove("comparing-two-revisions"),0!=o.value&&(i.value=parseInt(o.value,10)-1,i.dispatchEvent(new Event("input"))),f["delete"]("from"),f["delete"]("to"),f.set("revision",u[o.value]),history.replaceState(null,null,"?"+f.toString()))}))}));