document.addEventListener("DOMContentLoaded",(function(){var e,t,{FilePond:a}=window,r=[],i=document.getElementById("widget-modal");function d(t,a,r){var d=t.dataset.id,n=t.getAttribute("aria-label"),l=t.dataset.date,o=t.dataset.filename,s=t.dataset.size,c=t.dataset.width,u=t.dataset.height,m=t.dataset.caption,y=t.dataset.description,p=t.dataset.taxes,g=t.dataset.tags,h=t.dataset.url,b=t.dataset.sizes,q="",S=JSON.parse(b),v=t.querySelector("img").getAttribute("alt"),A=t.dataset.updateNonce,f=t.dataset.deleteNonce,L=a.querySelector('[data-property="link_type"]').value,E=a.querySelector('[data-property="link_url"]'),w=i.querySelectorAll(".widget-modal-right-sidebar input, .widget-modal-right-sidebar textarea, .widget-modal-media-embed input, .widget-modal-media-embed textarea"),_=i.querySelectorAll(".widget-modal-right-sidebar select, .widget-modal-media-embed select"),x=i.querySelector("#attachment-display-settings-link-to"),T=i.querySelector("#attachment-display-settings-link-to-custom");for(var G in S)q+='<option value="'+G+'">'+G[0].toUpperCase()+G.slice(1)+" \u2013 "+S[G].width+" x "+S[G].height+"</option>";!function(e){var t=document.createElement("form");t.className="compat-item",t.innerHTML='<input type="hidden" id="menu-order" name="attachments['+e+'][menu_order]" value="0"><p class="media-types media-types-required-info"><span class="required-field-message">Required fields are marked <span class="required">*</span></span></p><div class="setting" data-setting="media_category"><label for="attachments-'+e+'-media_category" style="width:30%;"><span class="alignleft">Media Categories</span></label><input type="text" class="text" id="attachments-'+e+'-media_category" name="attachments['+e+'][media_category]" value=""></div><div class="setting" data-setting="media_post_tag"><label for="attachments-'+e+'-media_post_tag"><span class="alignleft">Media Tags</span></label><input type="text" class="text" id="attachments-'+e+'-media_post_tag" name="attachments['+e+'][media_post_tag]" value=""></div>',null!=document.querySelector(".compat-item")&&document.querySelector(".compat-item").remove(),document.querySelector(".attachment-compat").append(t)}(d),i.querySelector(".attachment-date").textContent=l,i.querySelector(".attachment-filename").textContent=o,i.querySelector(".attachment-filesize").textContent=s,i.querySelector(".attachment-dimensions").textContent=c+" "+GALLERY_WIDGET.by+" "+u+" "+GALLERY_WIDGET.pixels,i.querySelector("#edit-more").href=ajaxurl.replace("admin-ajax.php","post.php?post="+d+"&action=edit"),i.querySelector("#attachment-details-description").textContent=y,i.querySelector("#attachment-details-copy-link").value=h,!0===r?(i.querySelector("#attachment-details-alt-text").textContent=v,i.querySelector("#attachment-details-title").value=n,i.querySelector("#attachment-details-caption").textContent=m,i.querySelector(".widget-modal-attachment-info img").src=h,i.querySelector(".widget-modal-attachment-info img").alt=v):(i.querySelector("#attachment-details-title").value=n,i.querySelector("#attachment-details-caption").textContent=a.querySelector('[data-property="caption"]')?a.querySelector('[data-property="caption"]').value:"",i.querySelector(".widget-modal-attachment-info img").src=a.querySelector('[data-property="url"]')?a.querySelector('[data-property="url"]').value:"",a.querySelector('[data-property="alt"]')&&(i.querySelector("#attachment-details-alt-text").textContent=a.querySelector('[data-property="alt"]').value,i.querySelector(".widget-modal-attachment-info img").alt=a.querySelector('[data-property="alt"]').value)),A?(w.forEach((function(e){e.removeAttribute("readonly")})),i.querySelector("#edit-more").parentNode.removeAttribute("hidden")):(w.forEach((function(e){e.setAttribute("readonly",!0)})),i.querySelector("#edit-more").parentNode.setAttribute("hidden",!0)),f?(_.forEach((function(e){e.removeAttribute("disabled")})),i.querySelector(".delete-attachment").parentNode.removeAttribute("hidden")):(_.forEach((function(e){e.setAttribute("disabled",!0)})),i.querySelector(".delete-attachment").parentNode.setAttribute("hidden",!0)),x.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected"),e.value===L&&e.setAttribute("selected",!0)})),"none"===x.value?(T.parentNode.classList.add("setting-hidden"),T.value=""):(T.value=null!=E?E.value:"",T.parentNode.classList.remove("setting-hidden")),x.addEventListener("change",(function(){var t=this[this.selectedIndex];x.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected")})),t.setAttribute("selected",!0),"none"===t.value?(T.parentNode.classList.add("setting-hidden"),T.value=""):("file"===t.value||"post"===t.value?T.value=h:"custom"===t.value&&(T.value=""),T.parentNode.classList.remove("setting-hidden")),e.removeAttribute("disabled")})),i.querySelector("#attachments-"+d+"-media_category").value=p,i.querySelector("#attachments-"+d+"-media_post_tag").value=g,i.querySelector("#attachment-display-settings-size").innerHTML=q,i.querySelector(".widget-modal-right-sidebar-info").removeAttribute("hidden"),i.querySelectorAll(".widget-modal-right-sidebar-info input, .widget-modal-right-sidebar-info textarea").forEach((function(e){e.addEventListener("change",(function(){"compat-item"===e.parentNode.parentNode.className?function(e,t){var a,r,i=new FormData,d=e.getAttribute("name").replace("attachments["+t+"][","").replace("]","");i.append("action","save-attachment-compat"),i.append("nonce",document.getElementById("media-"+t).dataset.updateNonce),i.append("id",t),i.append("taxonomy",d),i.append("attachments["+t+"]["+d+"]",e.value),fetch(ajaxurl,{method:"POST",body:i,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(i){i.success?("media_category"===d?(r=i.data.media_cats.join(", "),e.value=r,document.getElementById("media-"+t).setAttribute("data-taxes",r)):"media_tag"===d&&(r=i.data.media_tags.join(", "),e.value=r,document.getElementById("media-"+t).setAttribute("data-tags",r)),clearTimeout(a),document.getElementById("tax-saved").classList.remove("hidden"),document.getElementById("tax-saved").setAttribute("aria-hidden","false"),a=setTimeout((function(){document.getElementById("tax-saved").classList.add("hidden"),document.getElementById("tax-saved").setAttribute("aria-hidden","true")}),3e3)):console.error(GALLERY_WIDGET.failed_update,i.data.error)}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))}(e,d):function(e,t){var a,r=new FormData;r.append("action","save-attachment"),r.append("id",t),r.append("nonce",document.getElementById("media-"+t).dataset.updateNonce),"alt"===e.parentNode.dataset.setting||"embed-image-settings-alt-text"===e.id?r.append("changes[alt]",e.value):"title"===e.parentNode.dataset.setting?r.append("changes[title]",e.value):"caption"===e.parentNode.dataset.setting||"embed-image-settings-caption"===e.id?r.append("changes[caption]",e.value):"description"===e.parentNode.dataset.setting&&r.append("changes[description]",e.value),fetch(ajaxurl,{method:"POST",body:r,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(r){var d=i.querySelector("#details-saved");r.success?("alt"===e.parentNode.dataset.setting?document.getElementById("media-"+t).querySelector("img").setAttribute("alt",e.value):"title"===e.parentNode.dataset.setting?document.getElementById("media-"+t).setAttribute("aria-label",e.value):"caption"===e.parentNode.dataset.setting?document.getElementById("media-"+t).setAttribute("data-caption",e.value):"description"===e.parentNode.dataset.setting&&document.getElementById("media-"+t).setAttribute("data-description",e.value),clearTimeout(a),d.classList.remove("hidden"),d.setAttribute("aria-hidden","false"),a=setTimeout((function(){d.classList.add("hidden"),d.setAttribute("aria-hidden","true")}),3e3)):console.error(GALLERY_WIDGET.failed_update,r.data.error)}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))}(e,d)}))})),t.className.includes("selected")?!1===r?(t.querySelector(".check").style.display="block",e.setAttribute("disabled",!0)):(t.classList.remove("selected"),t.setAttribute("aria-checked",!1),t.querySelector(".check").style.display="none",i.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0),null==document.querySelector(".media-item.selected")&&(e&&e.setAttribute("disabled",!0),i.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0))):(t.classList.add("selected"),t.setAttribute("aria-checked",!0),t.querySelector(".check").style.display="block",e&&e.removeAttribute("disabled"))}function n(e,t){var a="",r=document.createElement("li"),i='<img src="'+e.url+'" alt="'+e.alt+'">';return t.querySelector('[data-property="attachment_id"]')?e.id==t.querySelector('[data-property="attachment_id"]').value&&(a=" selected"):t.querySelector('[data-property="ids"]')&&t.querySelector('[data-property="ids"]').value.split(",").indexOf(e.id).value&&(a=" selected"),r.className="media-item"+a,r.id="media-"+e.id,r.setAttribute("tabindex",0),r.setAttribute("role","checkbox"),r.setAttribute("aria-checked",!!a),r.setAttribute("aria-label",e.title),r.setAttribute("data-id",e.id),r.setAttribute("data-date",e.dateFormatted),r.setAttribute("data-url",e.url),r.setAttribute("data-filename",e.filename),r.setAttribute("data-filetype",e.type),r.setAttribute("data-mime",e.mime),r.setAttribute("data-width",e.width),r.setAttribute("data-height",e.height),r.setAttribute("data-size",e.filesizeHumanReadable),r.setAttribute("data-caption",e.caption),r.setAttribute("data-description",e.description),r.setAttribute("data-link",e.link),r.setAttribute("data-orientation",e.orientation),r.setAttribute("data-menu-order",e.menuOrder),r.setAttribute("data-taxes",e.media_cats),r.setAttribute("data-tags",e.media_tags),r.setAttribute("data-sizes",JSON.stringify(e.sizes)),r.setAttribute("data-update-nonce",e.nonces.update),r.setAttribute("data-delete-nonce",e.nonces["delete"]),r.setAttribute("data-edit-nonce",e.nonces.edit),r.innerHTML='<div class="select-attachment-preview type-'+e.type+" subtype-"+e.subtype+'"><div class="media-thumbnail">'+i+'</div></div><button type="button" class="check" tabindex="-1"><span class="media-modal-icon"></span><span class="screen-reader-text">'+GALLERY_WIDGET.deselect+"></span></button>",r}function l(t){var a=document.getElementById("tmpl-media-grid-modal").content.cloneNode(!0),l=a.querySelector(".widget-modal-header-buttons"),o=a.querySelector("#widget-modal-media-content"),s=i.querySelector("header"),c=document.getElementById("tmpl-edit-gallery-modal").content.cloneNode(!0),u=i.querySelector("#menu-item-add"),m=i.querySelector("#menu-item-gallery"),y=new URLSearchParams({action:"query-attachments","query[posts_per_page]":GALLERY_WIDGET.per_page,"query[post_mime_type]":"image","query[paged]":1});r=[],fetch(ajaxurl,{method:"POST",body:y,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(a){a.success&&(s.append(l),null==i.querySelector("#widget-modal-media-content")&&s.after(o),i.querySelector(".widget-modal-title h2").textContent=GALLERY_WIDGET.create_gallery,i.querySelector(".separator").insertAdjacentHTML("afterend",c.querySelector("#gallery-buttons").innerHTML),i.querySelector(".media-library-grid-section").after(c.querySelector(".media-gallery-grid-section")),i.querySelector(".widget-modal-right-sidebar").prepend(c.querySelector(".widget-modal-gallery-settings")),i.querySelector("footer").replaceWith(c.querySelector("footer")),u.setAttribute("hidden",!0),u.setAttribute("aria-selected",!1),m.textContent=GALLERY_WIDGET.create_gallery,m.removeAttribute("hidden"),m.classList.add("active"),m.setAttribute("aria-selected",!0),i.querySelector("#widget-modal-media-content").dataset.widgetId=t.id,i.querySelector("#menu-item-embed").setAttribute("hidden",!0),(e=i.querySelector("#gallery-button-new")).classList.remove("hidden"),0===a.data.length?(i.querySelectorAll(".pagination-links button").forEach((function(e){e.setAttribute("data-page",1),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)})),i.querySelector("#current-page-selector").setAttribute("value",1),i.querySelector(".total-pages").textContent=1,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,0),i.querySelector(".load-more-count").setAttribute("hidden",!0),i.querySelector(".no-media").removeAttribute("hidden")):(a.data.forEach((function(e){var a=n(e,t);i.querySelector(".widget-modal-grid").append(a)})),i.querySelectorAll(".pagination-links button").forEach((function(e){e.className.includes("next-page")?1!==a.headers.max_pages&&(e.setAttribute("data-page",2),e.removeAttribute("disabled"),e.removeAttribute("inert")):e.className.includes("last-page")&&(e.setAttribute("data-page",a.headers.max_pages),1!==a.headers.max_pages&&(e.removeAttribute("disabled"),e.removeAttribute("inert")))})),i.querySelector(".total-pages").textContent=a.headers.max_pages,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,a.headers.total_posts),i.querySelectorAll(".media-item").forEach((function(e){e.className.includes("selected")&&d(e,t,!1),e.addEventListener("click",(function(){d(e,t,!0)}))})),i.querySelector(".no-media").setAttribute("hidden",!0),i.querySelector(".load-more-count").removeAttribute("hidden"),i.querySelector(".load-more-count").textContent=a.data.length+" "+GALLERY_WIDGET.of+" "+a.headers.total_posts+" "+GALLERY_WIDGET.media_items))}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)})),i.showModal()}function o(t,a){var r=i.querySelector("#filter-by-date"),l=r.nextElementSibling,o=i.querySelector("#widget-modal-search-input"),s=new URLSearchParams({action:"query-attachments","query[posts_per_page]":GALLERY_WIDGET.per_page,"query[monthnum]":r.value?parseInt(r.value.substr(4,2),10):0,"query[year]":r.value?parseInt(r.value.substr(0,4),10):0,"query[post_mime_type]":"image","query[s]":o.value?o.value:"","query[paged]":a||1,"query[media_category_name]":l.value?l.value:""});fetch(ajaxurl,{method:"POST",body:s,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(r){r.success&&(null===(e=i.querySelector("#media-button-insert"))?e=i.querySelector("#gallery-button-update"):null===e&&(e=i.querySelector("#gallery-button-new")),i.querySelector(".widget-modal-grid").innerHTML="",0===r.data.length?(i.querySelectorAll(".pagination-links button").forEach((function(e){e.setAttribute("data-page",1),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)})),i.querySelector("#current-page-selector").setAttribute("value",1),i.querySelector(".total-pages").textContent=1,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,0),i.querySelector(".load-more-count").setAttribute("hidden",!0),i.querySelector(".no-media").removeAttribute("hidden")):(r.data.forEach((function(e){var a=n(e,t);i.querySelector(".widget-modal-grid").append(a)})),i.querySelectorAll(".pagination-links button").forEach((function(e){e.className.includes("first-page")||e.className.includes("prev-page")?"1"===a?(e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.removeAttribute("disabled"),e.removeAttribute("inert"),e.className.includes("prev-page")&&(parseInt(a)-1<1?e.setAttribute("data-page",1):e.setAttribute("data-page",parseInt(a)-1))):e.className.includes("next-page")?r.headers.max_pages===parseInt(a)?(e.setAttribute("data-page",a),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.setAttribute("data-page",parseInt(a)+1),e.removeAttribute("disabled"),e.removeAttribute("inert")):e.className.includes("last-page")&&(e.setAttribute("data-page",r.headers.max_pages),r.headers.max_pages===parseInt(a)?(e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.removeAttribute("disabled"),e.removeAttribute("inert")))})),i.querySelector("#current-page-selector").setAttribute("value",a||1),i.querySelector("#current-page-selector").value=a||1,i.querySelector(".total-pages").textContent=r.headers.max_pages,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,r.headers.total_posts),null==i.querySelector(".media-item.selected")&&(e.setAttribute("disabled",!0),i.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0)),i.querySelectorAll(".media-item").forEach((function(e){e.className.includes("selected")&&(d(e,t,!1),e.focus()),e.addEventListener("click",(function(){d(e,t,!0)}))})),i.querySelector(".no-media").setAttribute("hidden",!0),i.querySelector(".load-more-count").removeAttribute("hidden"),i.querySelector(".load-more-count").textContent=r.data.length+" "+GALLERY_WIDGET.of+" "+r.headers.total_posts+" "+GALLERY_WIDGET.media_items))}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)})),i.showModal()}function s(e,t){var a,d,l,o,s=document.getElementById("tmpl-media-grid-modal").content.cloneNode(!0),u=s.querySelector(".widget-modal-header-buttons"),m=s.querySelector("#widget-modal-media-content"),y=i.querySelector("header"),p=document.getElementById("tmpl-edit-gallery-modal").content.cloneNode(!0),g=[],h="update"===t?r:e.querySelector('[data-property="ids"]').value.split(",");y.append(u),y.after(m),i.querySelector(".separator").insertAdjacentHTML("afterend",p.querySelector("#gallery-buttons").innerHTML),i.querySelector(".media-library-grid-section").after(p.querySelector(".media-gallery-grid-section")),i.querySelector(".widget-modal-right-sidebar").prepend(p.querySelector(".widget-modal-gallery-settings")),i.querySelector("footer").replaceWith(p.querySelector("footer")),i.querySelector("#menu-item-embed").removeAttribute("hidden"),i.querySelector(".media-library-select-section").classList.add("hidden"),i.querySelector("#widget-modal-title h2").textContent=GALLERY_WIDGET.edit_gallery,u.style.display="none",i.querySelector("#menu-item-embed").setAttribute("hidden",!0),i.querySelector(".media-library-grid-section").classList.add("hidden"),i.querySelector(".media-gallery-grid-section").classList.remove("hidden"),(a=i.querySelector("#menu-item-add")).classList.remove("active"),a.setAttribute("hidden",!0),a.setAttribute("aria-selected",!1),(d=i.querySelector("#menu-item-gallery-edit")).removeAttribute("hidden"),d.classList.add("active"),d.setAttribute("aria-selected",!0),i.querySelector("#gallery-button-new").classList.add("hidden"),i.querySelector("#menu-item-gallery-library").removeAttribute("hidden"),i.querySelector("#gallery-button-insert").classList.remove("hidden"),i.querySelector(".widget-modal-gallery-settings").removeAttribute("hidden"),i.querySelector("#gallery-settings-size").value=e.querySelector('[data-property="size"]').value,i.querySelector("#gallery-settings-columns").value=e.querySelector('[data-property="columns"]').value,i.querySelector("#gallery-settings-link-to").value=e.querySelector('[data-property="link_type"]').value,i.querySelector("#gallery-settings-random-order").checked="on"===e.querySelector('[data-property="orderby_random"]').value,i.querySelector(".widget-modal-gallery-settings").removeAttribute("hidden"),(l=i.querySelector("#menu-item-gallery")).classList.add("cancel"),l.textContent=GALLERY_WIDGET.cancel_gallery,l.removeAttribute("hidden"),(o=new FormData).append("action","query-attachments"),o.append("query[post__in]",h),o.append("query[orderby]","post__in"),o.append("query[post_mime_type]","image"),o.append("query[paged]",1),fetch(ajaxurl,{method:"POST",body:o,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(t){t.success&&(i.querySelector("#widget-modal-media-content").dataset.widgetId=e.id,r=[],t.data.forEach((function(t){var a=n(t,e);r.push(a.dataset.id),g.push(a)})),c(g,e,"edit"),i.showModal())}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))}function c(e,t,a){var n=i.querySelector("#gallery-grid");e.forEach((function(e){var t;e.classList.add("selected"),e.setAttribute("aria-checked",!0),e.querySelector(".check").style.display="block",null==e.querySelector(".describe")&&((t=document.createElement("input")).className="describe",t.type="text",t.value=e.dataset.caption,t.dataset.setting="caption",t.setAttribute("aria-label","Caption"),t.placeholder=GALLERY_WIDGET.caption+"...",e.append(t)),n.append(e)})),i.querySelectorAll(".describe").forEach((function(e){e.addEventListener("change",(function(){var t,a,r,i,d=e.closest("li");t=d.dataset.id,a=d.dataset.updateNonce,r=e.value,(i=new FormData).append("action","save-attachment"),i.append("id",t),i.append("nonce",a),i.append("post_id",0),i.append("changes[caption]",r),fetch(ajaxurl,{method:"POST",body:i,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){e.success||console.error(GALLERY_WIDGET.failed_update,e.data.error)}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))}))})),Sortable.create(n,{group:"items",sort:!0,handle:"li",fallbackTolerance:2,onChoose:function(e){"check"===e.originalEvent.target.className&&e.item.remove(),"edit"===a&&d(e.item,t,!0)},onUnchoose:function(){setTimeout((function(){n.dispatchEvent(new Event("change"))}),0)}}),n.addEventListener("change",(function(){var e=n.querySelectorAll(".selected");r=[],e.forEach((function(e){r.push(e.dataset.id)})),0===r.length?i.querySelector("#gallery-button-insert").disabled=!0:i.querySelector("#gallery-button-insert").disabled=!1}))}function u(){i.close(),m()}function m(){var e=i.querySelector("#menu-item-add"),t=i.querySelector("#menu-item-gallery");i.querySelector(".widget-modal-header-buttons")&&i.querySelector(".widget-modal-header-buttons").remove(),i.querySelector("#widget-modal-media-content")&&i.querySelector("#widget-modal-media-content").remove(),i.querySelector("#image-modal-content")&&i.querySelector("#image-modal-content").remove(),i.querySelector(".widget-modal-footer")&&i.querySelector(".widget-modal-footer").remove(),i.querySelector("#menu-item-gallery-edit")&&i.querySelector("#menu-item-gallery-edit").remove(),i.querySelector("#menu-item-gallery-library")&&i.querySelector("#menu-item-gallery-library").remove(),i.querySelector(".media-gallery-grid-section")&&i.querySelector(".media-gallery-grid-section").remove(),i.querySelector(".widget-modal-gallery-settings")&&i.querySelector(".widget-modal-gallery-settings").remove(),i.removeAttribute("style"),e.removeAttribute("hidden"),e.setAttribute("aria-selected",!0),t.setAttribute("hidden",!0),t.setAttribute("aria-selected",!1),i.querySelector(".widget-modal-headings").removeAttribute("style"),i.querySelector(".widget-modal-title h2").textContent=GALLERY_WIDGET.media_library}document.addEventListener("click",(function(y){var p,g,h,b,q,S,v,A,f,L,E,w,_,x,T,G,N,I,k,C,R,D,W,Y,B,j,P,F,M=[],O=y.target.closest(".widget");if(O)(h=O.querySelector(".id_base"))&&"media_gallery"===h.value&&"BUTTON"===y.target.tagName&&(y.target.className.includes("select-media")?l(O):y.target.className.includes("edit-media")&&s(O,"renew"));else if("widget-modal-close"===y.target.id)u();else if(i.querySelector("#widget-modal-media-content")&&(p=i.querySelector("#widget-modal-media-content").dataset.widgetId,(h=(g=document.getElementById(p)).querySelector(".id_base"))&&"media_gallery"===h.value))if(b=g.querySelector(".media-widget-gallery-preview"),q=i.querySelector("#menu-item-add"),f=i.querySelector("#menu-item-gallery"),S=i.querySelector("#menu-item-gallery-edit"),v=i.querySelector("#menu-item-gallery-library"),L=i.querySelector("#menu-item-upload"),E=i.querySelector("#menu-item-browse"),w=i.querySelector("#gallery-button-insert"),_=i.querySelector("#gallery-button-update"),R=i.querySelector(".widget-modal-right-sidebar-info"),C=i.querySelector(".widget-modal-gallery-settings"),x=i.querySelector("#uploader-inline"),G=i.querySelector(".widget-modal-header-buttons"),A=i.querySelector(".widget-modal-pages"),T=i.querySelector(".media-library-select-section"),I=i.querySelector(".media-library-grid-section"),k=i.querySelectorAll(".media-library-grid-section li"),N=i.querySelector(".media-gallery-grid-section"),i.querySelector(".media-frame-content"),i.querySelectorAll("#attachments-browser, .media-views-heading, .attachments-wrapper, .media-sidebar, .widgets-modal-pages, .media-frame-toolbar"),"pagination-links"===y.target.parentNode.className&&"BUTTON"===y.target.tagName)Y=y.target.dataset.page,o(g,Y);else if(y.target.parentNode.parentNode&&"pagination-links"===y.target.parentNode.parentNode.className&&"BUTTON"===y.target.parentNode.tagName)Y=y.target.parentNode.dataset.page,o(g,Y);else if("menu-item-gallery"===y.target.id)u(),y.target.className.includes("cancel")||(l(g),y.target.textContent=GALLERY_WIDGET.create_gallery);else if("menu-item-gallery-edit"===y.target.id){if(y.target.className.includes("active"))return;v.classList.remove("active"),v.setAttribute("aria-selected",!1),_.classList.add("hidden"),_.setAttribute("disabled",!0),G.style.display="none",T.classList.add("hidden"),I.classList.add("hidden"),y.target.classList.add("active"),y.target.setAttribute("aria-selected",!0),N.classList.remove("hidden"),C.removeAttribute("hidden"),w.classList.remove("hidden"),w.removeAttribute("disabled")}else"menu-item-gallery-library"===y.target.id?(R.setAttribute("hidden",!0),C.setAttribute("hidden",!0),S.classList.remove("active"),S.setAttribute("aria-selected",!1),L.classList.remove("active"),L.setAttribute("aria-selected",!1),q.classList.remove("active"),q.setAttribute("aria-selected",!1),y.target.classList.add("active"),y.target.setAttribute("aria-selected",!0),w.classList.add("hidden"),w.setAttribute("disabled",!0),N.classList.add("hidden"),R.setAttribute("hidden",!0),I.classList.remove("hidden"),function(t){var a,l=[],o=new FormData;o.append("action","query-attachments"),o.append("query[post__not_in]",r),o.append("query[post_mime_type]","image"),o.append("query[paged]",1),fetch(ajaxurl,{method:"POST",body:o,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(r){r.success&&((a=i.querySelector(".media-library-grid-section")).querySelector("ul").innerHTML="",i.querySelector(".widget-modal-title h2").textContent=GALLERY_WIDGET.add_to_gallery,0===r.data.length?(i.querySelectorAll(".pagination-links button").forEach((function(e){e.setAttribute("data-page",1),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)})),i.querySelector("#current-page-selector").setAttribute("value",1),i.querySelector(".total-pages").textContent=1,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,0),i.querySelector(".load-more-count").setAttribute("hidden",!0),i.querySelector(".no-media").removeAttribute("hidden")):(r.data.forEach((function(e){var r=n(e,t);a.querySelector("ul").append(r),l.push(r)})),i.querySelectorAll(".pagination-links button").forEach((function(e){e.className.includes("next-page")?1!==r.headers.max_pages&&(e.setAttribute("data-page",2),e.removeAttribute("disabled"),e.removeAttribute("inert")):e.className.includes("last-page")&&(e.setAttribute("data-page",r.headers.max_pages),1!==r.headers.max_pages&&(e.removeAttribute("disabled"),e.removeAttribute("inert")))})),i.querySelector(".total-pages").textContent=r.headers.max_pages,i.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,r.headers.total_posts),i.querySelectorAll(".media-item").forEach((function(e){e.addEventListener("click",(function(){d(e,t,!0)}))})),i.querySelector(".no-media").setAttribute("hidden",!0),i.querySelector(".load-more-count").removeAttribute("hidden"),i.querySelector(".load-more-count").textContent=r.data.length+" "+GALLERY_WIDGET.of+" "+r.headers.total_posts+" media items"),i.querySelector(".widget-modal-header-buttons").style.display="flex",i.querySelector(".media-library-select-section").classList.remove("hidden"),a.classList.remove("hidden"),e=i.querySelector("#gallery-button-new"))}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))}(g),_.classList.remove("hidden"),_.removeAttribute("disabled")):"gallery-button-new"===y.target.id?(i.querySelector("#widget-modal-title h2").textContent=GALLERY_WIDGET.edit_gallery,G.style.display="none",R.setAttribute("hidden",!0),y.target.classList.add("hidden"),q.classList.remove("active"),q.setAttribute("aria-selected",!1),q.setAttribute("hidden",!0),L.classList.remove("active"),L.setAttribute("aria-selected",!1),I.classList.add("hidden"),T.classList.add("hidden"),f.textContent=GALLERY_WIDGET.cancel_gallery,f.removeAttribute("hidden"),f.classList.remove("active"),f.setAttribute("aria-selected",!1),S.removeAttribute("hidden"),S.classList.add("active"),S.setAttribute("aria-selected",!0),v.removeAttribute("hidden"),N.classList.remove("hidden"),w.classList.remove("hidden"),i.querySelector(".widget-modal-gallery-settings").removeAttribute("hidden"),k.forEach((function(e){e.className.includes("selected")?(r.push(e.dataset.id),M.push(e)):(e.setAttribute("hidden",!0),e.setAttribute("inert",!0))})),c(M,g,"select")):"menu-item-upload"===y.target.id?(E.classList.remove("active"),E.setAttribute("aria-selected",!1),q.classList.remove("active"),q.setAttribute("aria-selected",!1),y.target.classList.add("active"),y.target.setAttribute("aria-selected",!0),A.classList.add("hidden"),T.classList.add("hidden"),I.classList.add("hidden"),I.setAttribute("inert",!0),N.classList.add("hidden"),R.parentNode.setAttribute("hidden",!0),R.parentNode.setAttribute("inert",!0),x.removeAttribute("hidden"),x.removeAttribute("inert"),function(e){var r=0;a.registerPlugin(FilePondPluginFileValidateSize,FilePondPluginFileValidateType,FilePondPluginFileRename,FilePondPluginImagePreview),t=a.create(i.querySelector("#filepond"),{allowMultiple:!0,server:{process:function(e,t,a,r,i,d,n){var l=new FormData;return l.append("async-upload",t,t.name),l.append("action","upload-attachment"),l.append("_wpnonce",document.getElementById("_wpnonce").value),fetch(ajaxurl,{method:"POST",body:l,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){e.success?r("finished"):i(GALLERY_WIDGET.upload_failed)}))["catch"]((function(e){i(GALLERY_WIDGET.upload_failed),console.error(GALLERY_WIDGET.error,e)})),{abort:function(){n()}}},maxFileSize:i.querySelector("#ajax-url").dataset.maxFileSize},onprocessfile:(e,a)=>{e||(setTimeout((function(){t.removeFile(a.id)}),100),r++,function(){var e,t=document.querySelectorAll(".media-item"),a=document.querySelector(".displaying-num").textContent.split(" "),r=document.querySelector(".load-more-count").textContent.split(" ");t.forEach((function(e,t){e.setAttribute("data-order",parseInt(t+1))})),e=5 in r?" "+r[5]:"";document.querySelector(".load-more-count").textContent=r[0]+" "+t.length+" "+r[2]+" "+t.length+" "+r[4]+e,document.querySelector(".displaying-num").textContent=t.length+" "+a[1]}())},onprocessfiles:()=>{i.querySelectorAll("#gallery-grid li").length?(o(document.getElementById(e),1),i.querySelector("#menu-item-browse").click(),setTimeout((function(){for(var e=1,t=r;e<=t;e++)i.querySelectorAll(".widget-modal-grid li")[e-1].click()}),500)):(m(),l(document.getElementById(e)),setTimeout((function(){for(var e=1,t=r;e<=t;e++)i.querySelectorAll(".widget-modal-grid li")[e-1].click()}),500))},labelTapToUndo:GALLERY_WIDGET.tap_close,fileRenameFunction:e=>new Promise((function(t){t(window.prompt(GALLERY_WIDGET.new_filename,e.name))})),acceptedFileTypes:document.querySelector(".uploader-inline").dataset.allowedMimes.split(","),labelFileTypeNotAllowed:GALLERY_WIDGET.invalid_type,fileValidateTypeLabelExpectedTypes:GALLERY_WIDGET.check_types})}(p)):"menu-item-browse"===y.target.id?(L.classList.remove("active"),L.setAttribute("aria-selected",!1),q.classList.add("active"),q.setAttribute("aria-selected",!0),y.target.classList.add("active"),y.target.setAttribute("aria-selected",!0),x.setAttribute("hidden",!0),x.setAttribute("inert",!0),A.classList.remove("hidden"),T.classList.remove("hidden"),I.classList.remove("hidden"),I.removeAttribute("inert"),R.parentNode.removeAttribute("hidden"),R.parentNode.removeAttribute("inert"),A.removeAttribute("hidden"),A.removeAttribute("inert")):"gallery-button-insert"===y.target.id?(b?b.innerHTML="":((D=document.createElement("ul")).className="media-widget-gallery-preview",(W=document.createElement("fieldset")).className="media-widget-buttons",W.innerHTML='<button type="button" class="button edit-media selected" data-edit-nonce="'+g.querySelector(".select-media").dataset.editNonce+'" style="margin-top:0;">'+GALLERY_WIDGET.edit_gallery+"</button>",g.querySelector(".attachment-media-view").replaceWith(D),g.querySelector(".media-widget-preview").after(W)),r=[],i.querySelectorAll("#gallery-grid .selected").forEach((function(e){var t=document.createElement("li");r.push(e.dataset.id),t.className="gallery-item",t.innerHTML='<div class="gallery-icon"><img alt="'+e.querySelector("img").alt+'" src="'+e.dataset.url+'" width="150" height="150"></div>',g.querySelector(".media-widget-gallery-preview").append(t)})),g.querySelector('[data-property="ids"]').value=r.toString(),g.querySelector('[data-property="link_type"]').value=i.querySelector("#gallery-settings-link-to").value,g.querySelector('[data-property="columns"]').value=i.querySelector("#gallery-settings-columns").value,g.querySelector('[data-property="orderby_random"]').value=i.querySelector("#gallery-settings-random-order").checked?1:"",g.querySelector('[data-property="size"]').value=i.querySelector("#gallery-settings-size").value,document.body.className.includes("widgets-php")&&g.classList.add("widget-dirty"),g.querySelector(".widget-control-save").textContent=GALLERY_WIDGET.save,g.dispatchEvent(new Event("change")),g.querySelector(".widget-control-save").disabled=!1,u()):"gallery-button-update"===y.target.id?(k.forEach((function(e){e.className.includes("selected")&&r.push(e.dataset.id)})),m(),s(g,"update")):y.target.className.includes("gallery-button-reverse")?(i.querySelectorAll("#gallery-grid li:not( [hidden] )").forEach((function(e){e.parentNode.prepend(e)})),r.reverse()):y.target.className.includes("delete-attachment")?g.querySelector('[data-property="ids"]')&&k.forEach((function(e){var t,a;e.className.includes("selected")&&(g.querySelector('[data-property="ids"]').value.split(",").includes(e.dataset.id)||window.confirm(GALLERY_WIDGET.confirm_delete)&&(t=e.dataset.id,a=new URLSearchParams({action:"delete-post",_ajax_nonce:document.getElementById("media-"+t).dataset.deleteNonce,id:t}),fetch(ajaxurl,{method:"POST",body:a,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){1===e?u():console.log(GALLERY_WIDGET.delete_failed)}))["catch"]((function(e){console.error(GALLERY_WIDGET.error,e)}))))})):y.target.className.includes("copy-attachment-url")&&(B=y.target,P=i.querySelector("#attachment-details-copy-link").value,F=document.createElement("input"),navigator.clipboard?navigator.clipboard.writeText(P):(document.body.append(F),F.value=P,F.select(),document.execCommand("copy")),clearTimeout(j),B.nextElementSibling.classList.remove("hidden"),F.remove(),j=setTimeout((function(){B.nextElementSibling.classList.add("hidden")}),3e3),wp.a11y.speak(wp.i18n.__("The file URL has been copied to your clipboard")))})),i.addEventListener("change",(function(e){var t,a,r;i.querySelector("#widget-modal-media-content")&&(t=i.querySelector("#widget-modal-media-content").dataset.widgetId,(r=(a=document.getElementById(t)).querySelector(".id_base"))&&"media_gallery"===r.value&&("filter-by-date"===e.target.id||"postform"===e.target.className?o(a,1):"current-page-selector"===e.target.id?o(a,e.target.value):"widget-modal-search-input"===e.target.id&&(o(a,1),i.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0))))})),document.addEventListener("keydown",(function(e){var t,a,r,d;i.querySelector("#widget-modal-media-content")&&(t=i.querySelector("#widget-modal-media-content").dataset.widgetId)&&(a=document.getElementById(t),r=a.querySelector("details"),(d=a.querySelector(".id_base"))&&"media_gallery"===d.value&&i.open&&"Escape"===e.key&&(u(),setTimeout((function(){r.open=!0}),100),r.addEventListener("toggle",(function(e){e.target.open&&(a.querySelector(".edit-media")?a.querySelector(".edit-media").focus():a.querySelector(".select-media").focus())}))))}))}));