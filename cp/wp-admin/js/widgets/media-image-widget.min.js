document.addEventListener("DOMContentLoaded",(function(){var e,t,{FilePond:a}=window,r=document.getElementById("widget-modal");function i(t,a,i){var d=r.querySelectorAll(".widget-modal-grid .selected"),o=t.dataset.id,l=t.getAttribute("aria-label"),n=t.dataset.date,u=t.dataset.filename,s=t.dataset.size,c=t.dataset.width,m=t.dataset.height,p=t.dataset.caption,y=t.dataset.description,g=t.dataset.taxes,v=t.dataset.tags,b=t.dataset.url,h=t.dataset.sizes,S="",q=JSON.parse(h),A=t.querySelector("img").getAttribute("alt"),f=t.dataset.updateNonce,w=t.dataset.deleteNonce,E=a.querySelector('[data-property="link_type"]').value,_=a.querySelector('[data-property="link_url"]'),I=r.querySelectorAll(".widget-modal-right-sidebar input, .widget-modal-right-sidebar textarea, .widget-modal-media-embed input, .widget-modal-media-embed textarea"),x=r.querySelectorAll(".widget-modal-right-sidebar select, .widget-modal-media-embed select"),k=r.querySelector("#attachment-display-settings-link-to"),N=r.querySelector("#attachment-display-settings-link-to-custom");for(var T in q)S+='<option value="'+T+'">'+T[0].toUpperCase()+T.slice(1)+" \u2013 "+q[T].width+" x "+q[T].height+"</option>";!function(e){var t=document.createElement("form");t.className="compat-item",t.innerHTML='<input type="hidden" id="menu-order" name="attachments['+e+'][menu_order]" value="0"><p class="media-types media-types-required-info"><span class="required-field-message">Required fields are marked <span class="required">*</span></span></p><div class="setting" data-setting="media_category"><label for="attachments-'+e+'-media_category" style="width:30%;"><span class="alignleft">Media Categories</span></label><input type="text" class="text" id="attachments-'+e+'-media_category" name="attachments['+e+'][media_category]" value=""></div><div class="setting" data-setting="media_post_tag"><label for="attachments-'+e+'-media_post_tag"><span class="alignleft">Media Tags</span></label><input type="text" class="text" id="attachments-'+e+'-media_post_tag" name="attachments['+e+'][media_post_tag]" value=""></div>',null!=document.querySelector(".compat-item")&&document.querySelector(".compat-item").remove(),document.querySelector(".attachment-compat").append(t)}(o),r.querySelector(".attachment-date").textContent=n,r.querySelector(".attachment-filename").textContent=u,r.querySelector(".attachment-filesize").textContent=s,r.querySelector(".attachment-dimensions").textContent=c+" "+IMAGE_WIDGET.by+" "+m+" "+IMAGE_WIDGET.pixels,r.querySelector("#edit-more").href=ajaxurl.replace("admin-ajax.php","post.php?post="+o+"&action=edit"),r.querySelector("#attachment-details-description").textContent=y,r.querySelector("#attachment-details-copy-link").value=b,!0===i?(r.querySelector("#attachment-details-alt-text").textContent=A,r.querySelector("#attachment-details-title").value=l,r.querySelector("#attachment-details-caption").textContent=p,r.querySelector(".widget-modal-attachment-info img").src=b,r.querySelector(".widget-modal-attachment-info img").alt=A):(r.querySelector("#attachment-details-title").value=l,r.querySelector("#attachment-details-caption").textContent=a.querySelector('[data-property="caption"]')?a.querySelector('[data-property="caption"]').value:"",r.querySelector(".widget-modal-attachment-info img").src=a.querySelector('[data-property="url"]')?a.querySelector('[data-property="url"]').value:"",a.querySelector('[data-property="alt"]')&&(r.querySelector("#attachment-details-alt-text").textContent=a.querySelector('[data-property="alt"]').value,r.querySelector(".widget-modal-attachment-info img").alt=a.querySelector('[data-property="alt"]').value)),f?(I.forEach((function(e){e.removeAttribute("readonly")})),r.querySelector("#edit-more").parentNode.removeAttribute("hidden")):(I.forEach((function(e){e.setAttribute("readonly",!0)})),r.querySelector("#edit-more").parentNode.setAttribute("hidden",!0)),w?(x.forEach((function(e){e.removeAttribute("disabled")})),r.querySelector(".delete-attachment").parentNode.removeAttribute("hidden")):(x.forEach((function(e){e.setAttribute("disabled",!0)})),r.querySelector(".delete-attachment").parentNode.setAttribute("hidden",!0)),k.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected"),e.value===E&&e.setAttribute("selected",!0)})),"none"===k.value?(N.parentNode.classList.add("setting-hidden"),N.value=""):(N.value=null!=_?_.value:"",N.parentNode.classList.remove("setting-hidden")),k.addEventListener("change",(function(){var t=this[this.selectedIndex];k.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected")})),t.setAttribute("selected",!0),"none"===t.value?(N.parentNode.classList.add("setting-hidden"),N.value=""):("file"===t.value||"post"===t.value?N.value=b:"custom"===t.value&&(N.value=""),N.parentNode.classList.remove("setting-hidden")),e.removeAttribute("disabled")})),r.querySelector("#attachments-"+o+"-media_category").value=g,r.querySelector("#attachments-"+o+"-media_post_tag").value=v,r.querySelector("#attachment-display-settings-size").innerHTML=S,r.querySelector(".widget-modal-right-sidebar-info").removeAttribute("hidden"),r.querySelectorAll(".widget-modal-right-sidebar-info input, .widget-modal-right-sidebar-info textarea").forEach((function(e){e.addEventListener("change",(function(){"compat-item"===e.parentNode.parentNode.className?function(e,t){var a,r,i=new FormData,d=e.getAttribute("name").replace("attachments["+t+"][","").replace("]","");i.append("action","save-attachment-compat"),i.append("nonce",document.getElementById("media-"+t).dataset.updateNonce),i.append("id",t),i.append("taxonomy",d),i.append("attachments["+t+"]["+d+"]",e.value),fetch(ajaxurl,{method:"POST",body:i,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(i){i.success?("media_category"===d?(r=i.data.media_cats.join(", "),e.value=r,document.getElementById("media-"+t).setAttribute("data-taxes",r)):"media_tag"===d&&(r=i.data.media_tags.join(", "),e.value=r,document.getElementById("media-"+t).setAttribute("data-tags",r)),clearTimeout(a),document.getElementById("tax-saved").classList.remove("hidden"),document.getElementById("tax-saved").setAttribute("aria-hidden","false"),a=setTimeout((function(){document.getElementById("tax-saved").classList.add("hidden"),document.getElementById("tax-saved").setAttribute("aria-hidden","true")}),3e3)):console.error(IMAGE_WIDGET.failed_update,i.data.error)}))["catch"]((function(e){console.error(IMAGE_WIDGET.error,e)}))}(e,o):function(e,t){var a,i=new FormData;i.append("action","save-attachment"),i.append("id",t),i.append("nonce",document.getElementById("media-"+t).dataset.updateNonce),"alt"===e.parentNode.dataset.setting||"embed-image-settings-alt-text"===e.id?i.append("changes[alt]",e.value):"title"===e.parentNode.dataset.setting?i.append("changes[title]",e.value):"caption"===e.parentNode.dataset.setting||"embed-image-settings-caption"===e.id?i.append("changes[caption]",e.value):"description"===e.parentNode.dataset.setting&&i.append("changes[description]",e.value),fetch(ajaxurl,{method:"POST",body:i,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(i){var d=r.querySelector("#details-saved");i.success?("alt"===e.parentNode.dataset.setting?document.getElementById("media-"+t).querySelector("img").setAttribute("alt",e.value):"title"===e.parentNode.dataset.setting?document.getElementById("media-"+t).setAttribute("aria-label",e.value):"caption"===e.parentNode.dataset.setting?document.getElementById("media-"+t).setAttribute("data-caption",e.value):"description"===e.parentNode.dataset.setting&&document.getElementById("media-"+t).setAttribute("data-description",e.value),clearTimeout(a),d.classList.remove("hidden"),d.setAttribute("aria-hidden","false"),a=setTimeout((function(){d.classList.add("hidden"),d.setAttribute("aria-hidden","true")}),3e3)):console.error(IMAGE_WIDGET.failed_update,i.data.error)}))["catch"]((function(e){console.error(IMAGE_WIDGET.error,e)}))}(e,o)}))})),t.className.includes("selected")?!1===i?(t.querySelector(".check").style.display="block",e.setAttribute("disabled",!0)):(t.classList.remove("selected"),t.setAttribute("aria-checked",!1),t.querySelector(".check").style.display="none",null==document.querySelector(".media-item.selected")&&(e.setAttribute("disabled",!0),r.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0))):(d&&d.forEach((function(e){e.classList.remove("selected"),e.setAttribute("aria-checked",!1),e.querySelector(".check").style.display="none"})),t.classList.add("selected"),t.setAttribute("aria-checked",!0),t.querySelector(".check").style.display="block",e.removeAttribute("disabled"))}function d(e,t){var a="",r=document.createElement("li"),i='<img src="'+e.url+'" alt="'+e.alt+'">';return t.querySelector('[data-property="attachment_id"]')?e.id==t.querySelector('[data-property="attachment_id"]').value&&(a=" selected"):t.querySelector('[data-property="ids"]')&&t.querySelector('[data-property="ids"]').value.split(",").indexOf(e.id).value&&(a=" selected"),r.className="media-item"+a,r.id="media-"+e.id,r.setAttribute("tabindex",0),r.setAttribute("role","checkbox"),r.setAttribute("aria-checked",!!a),r.setAttribute("aria-label",e.title),r.setAttribute("data-id",e.id),r.setAttribute("data-date",e.dateFormatted),r.setAttribute("data-url",e.url),r.setAttribute("data-filename",e.filename),r.setAttribute("data-filetype",e.type),r.setAttribute("data-mime",e.mime),r.setAttribute("data-width",e.width),r.setAttribute("data-height",e.height),r.setAttribute("data-size",e.filesizeHumanReadable),r.setAttribute("data-caption",e.caption),r.setAttribute("data-description",e.description),r.setAttribute("data-link",e.link),r.setAttribute("data-orientation",e.orientation),r.setAttribute("data-menu-order",e.menuOrder),r.setAttribute("data-taxes",e.media_cats),r.setAttribute("data-tags",e.media_tags),r.setAttribute("data-sizes",JSON.stringify(e.sizes)),r.setAttribute("data-update-nonce",e.nonces.update),r.setAttribute("data-delete-nonce",e.nonces["delete"]),r.setAttribute("data-edit-nonce",e.nonces.edit),r.innerHTML='<div class="select-attachment-preview type-'+e.type+" subtype-"+e.subtype+'"><div class="media-thumbnail">'+i+'</div></div><button type="button" class="check" tabindex="-1"><span class="media-modal-icon"></span><span class="screen-reader-text">'+IMAGE_WIDGET.deselect+"></span></button>",r}function o(t,a){var o=r.querySelector("#filter-by-date"),l=o.nextElementSibling,n=r.querySelector("#widget-modal-search-input"),u=new URLSearchParams({action:"query-attachments","query[posts_per_page]":IMAGE_WIDGET.per_page,"query[monthnum]":o.value?parseInt(o.value.substr(4,2),10):0,"query[year]":o.value?parseInt(o.value.substr(0,4),10):0,"query[post_mime_type]":"image","query[s]":n.value?n.value:"","query[paged]":a||1,"query[media_category_name]":l.value?l.value:""});fetch(ajaxurl,{method:"POST",body:u,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(o){o.success&&(e=r.querySelector("#media-button-insert"),r.querySelector(".widget-modal-grid").innerHTML="",0===o.data.length?(r.querySelectorAll(".pagination-links button").forEach((function(e){e.setAttribute("data-page",1),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)})),r.querySelector("#current-page-selector").setAttribute("value",1),r.querySelector(".total-pages").textContent=1,r.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,0),r.querySelector(".load-more-count").setAttribute("hidden",!0),r.querySelector(".no-media").removeAttribute("hidden")):(o.data.forEach((function(e){var a=d(e,t);r.querySelector(".widget-modal-grid").append(a)})),r.querySelectorAll(".pagination-links button").forEach((function(e){e.className.includes("first-page")||e.className.includes("prev-page")?"1"===a?(e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.removeAttribute("disabled"),e.removeAttribute("inert"),e.className.includes("prev-page")&&(parseInt(a)-1<1?e.setAttribute("data-page",1):e.setAttribute("data-page",parseInt(a)-1))):e.className.includes("next-page")?o.headers.max_pages===parseInt(a)?(e.setAttribute("data-page",a),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.setAttribute("data-page",parseInt(a)+1),e.removeAttribute("disabled"),e.removeAttribute("inert")):e.className.includes("last-page")&&(e.setAttribute("data-page",o.headers.max_pages),o.headers.max_pages===parseInt(a)?(e.setAttribute("disabled",!0),e.setAttribute("inert",!0)):(e.removeAttribute("disabled"),e.removeAttribute("inert")))})),r.querySelector("#current-page-selector").setAttribute("value",a||1),r.querySelector("#current-page-selector").value=a||1,r.querySelector(".total-pages").textContent=o.headers.max_pages,r.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,o.headers.total_posts),null==r.querySelector(".media-item.selected")&&(e.setAttribute("disabled",!0),r.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0)),r.querySelectorAll(".media-item").forEach((function(e){e.className.includes("selected")&&(i(e,t,!1),e.focus()),e.addEventListener("click",(function(){i(e,t,!0)}))})),r.querySelector(".no-media").setAttribute("hidden",!0),r.querySelector(".load-more-count").removeAttribute("hidden"),r.querySelector(".load-more-count").textContent=o.data.length+" "+IMAGE_WIDGET.of+" "+o.headers.total_posts+" "+IMAGE_WIDGET.media_items))}))["catch"]((function(e){console.error(IMAGE_WIDGET.error,e)})),r.showModal()}function l(t){var a=t.split(".").pop(),i=document.createElement("div"),d=r.querySelector("#message"),o=new Image,l=r.querySelector("#widget-modal-media-content").dataset.widgetId,n=document.getElementById(l),u=r.querySelectorAll("#widget-modal-url-settings input, #widget-modal-url-settings textarea");o.src=t,o.onerror=function(){d&&d.remove(),i.id="message",i.className="notice-error is-dismissible",i.innerHTML='<p style="color:#fff;background:red;font-size:1em;padding:0.5em 1em;margin-top:-1px;">'+IMAGE_WIDGET.wrong_url+"</p>",r.querySelector("#widget-modal-embed-url-field").before(i),e.setAttribute("disabled",!0),u.forEach((function(e){e.setAttribute("disabled",!0)}))},o.onload=function(){n.querySelector('[data-property="width"]').value=o.width,n.querySelector('[data-property="height"]').value=o.height},r.querySelector(".widget-modal-media-embed .thumbnail img")&&r.querySelector(".widget-modal-media-embed .thumbnail img").remove(),r.querySelector(".widget-modal-media-embed .thumbnail").append(o),r.querySelector(".widget-modal-media-embed img").src=t,n.querySelector('[data-property="url"]').value=t,IMAGE_WIDGET.image_file_types.includes(a.toLowerCase())?d&&(d.remove(),u.forEach((function(e){e.removeAttribute("disabled")}))):(d&&d.remove(),i.id="message",i.className="notice-error",i.innerHTML='<p style="color:#fff;background:red;font-size:16px;padding:0.5em 1em;margin-top:-1px;">'+IMAGE_WIDGET.unsupported_file_type+"</p>",r.querySelector("#widget-modal-embed-url-field").before(i),e.setAttribute("disabled",!0),u.forEach((function(e){e.setAttribute("disabled",!0)})))}function n(){var e,t,a;r.querySelector("#widget-modal-media-content")&&window.innerWidth<901&&((a=r.querySelector("details")).removeAttribute("hidden"),a.addEventListener("toggle",(function(i){i.target.open&&((e=r.querySelector("#menu-item-add")).removeAttribute("hidden"),e.setAttribute("aria-selected",!0),(t=r.querySelector("#menu-item-embed")).removeAttribute("hidden"),a.append(e),a.append(t))})))}function u(){r.close(),r.querySelector(".widget-modal-header-buttons")&&r.querySelector(".widget-modal-header-buttons").remove(),r.querySelector("#widget-modal-media-content")&&r.querySelector("#widget-modal-media-content").remove(),r.querySelector("#image-modal-content")&&r.querySelector("#image-modal-content").remove(),r.querySelector(".widget-modal-footer")&&r.querySelector(".widget-modal-footer").remove(),r.removeAttribute("style"),r.querySelector(".widget-modal-headings").removeAttribute("style"),r.querySelector(".widget-modal-left-sidebar").classList.remove("hidden")}document.addEventListener("click",(function(s){var c,m,p,y,g,v,b,h,S,q,A,f,w,E,_,I,x,k,N,T=s.target.closest(".widget");T?(c=T.querySelector(".id_base"))&&"media_image"===c.value&&"BUTTON"===s.target.tagName&&(s.target.className.includes("select-media")?function(t){var a=document.getElementById("tmpl-media-grid-modal").content.cloneNode(!0),o=a.querySelector(".widget-modal-header-buttons"),l=a.querySelector("#widget-modal-media-content"),u=r.querySelector("header"),s=new URLSearchParams({action:"query-attachments","query[posts_per_page]":IMAGE_WIDGET.per_page,"query[post_mime_type]":"image","query[paged]":1});fetch(ajaxurl,{method:"POST",body:s,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(a){a.success&&(u.append(o),u.after(l),r.querySelector("#menu-item-embed").removeAttribute("hidden"),r.querySelector("#menu-item-add").textContent=IMAGE_WIDGET.add_image,n(),r.querySelector("#widget-modal-media-content").dataset.widgetId=t.id,e=r.querySelector("#media-button-insert"),r.querySelector("#menu-item-browse").click(),0===a.data.length?(r.querySelectorAll(".pagination-links button").forEach((function(e){e.setAttribute("data-page",1),e.setAttribute("disabled",!0),e.setAttribute("inert",!0)})),r.querySelector("#current-page-selector").setAttribute("value",1),r.querySelector(".total-pages").textContent=1,r.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,0),r.querySelector(".load-more-count").setAttribute("hidden",!0),r.querySelector(".no-media").removeAttribute("hidden")):(a.data.forEach((function(e){var a=d(e,t);r.querySelector(".widget-modal-grid").append(a)})),r.querySelectorAll(".pagination-links button").forEach((function(e){e.className.includes("next-page")?1!==a.headers.max_pages&&(e.setAttribute("data-page",2),e.removeAttribute("disabled"),e.removeAttribute("inert")):e.className.includes("last-page")&&(e.setAttribute("data-page",a.headers.max_pages),1!==a.headers.max_pages&&(e.removeAttribute("disabled"),e.removeAttribute("inert")))})),r.querySelector(".total-pages").textContent=a.headers.max_pages,r.querySelector(".displaying-num").textContent=document.querySelector(".displaying-num").textContent.replace(/[0-9]+/,a.headers.total_posts),r.querySelectorAll(".media-item").forEach((function(e){e.className.includes("selected")&&i(e,t,!1),e.addEventListener("click",(function(){i(e,t,!0)}))})),r.querySelector(".no-media").setAttribute("hidden",!0),r.querySelector(".load-more-count").removeAttribute("hidden"),r.querySelector(".load-more-count").textContent=a.data.length+" "+IMAGE_WIDGET.of+" "+a.headers.total_posts+" "+IMAGE_WIDGET.media_items))}))["catch"]((function(e){console.error(IMAGE_WIDGET.error,e)})),r.showModal()}(T):s.target.className.includes("edit-media")&&function(e){var t,a,i,d,o,l,u,s,c,m=e.querySelector('[data-property="size"]').value,p=e.querySelector('[data-property="width"]').value,y=e.querySelector('[data-property="height"]').value,g=e.querySelector('[data-property="caption"]').value,v=e.querySelector('[data-property="alt"]').value,b=e.querySelector('[data-property="link_type"]').value,h=e.querySelector('[data-property="link_url"]').value,S=e.querySelector('[data-property="image_classes"]').value,q=e.querySelector('[data-property="link_classes"]').value,A=e.querySelector('[data-property="link_rel"]').value,f=e.querySelector('[data-property="link_target_blank"]').value,w=e.querySelector('[data-property="link_image_title"]').value,E=e.querySelector('[data-property="attachment_id"]').value,_=e.querySelector('[data-property="url"]').value,I=e.querySelector('[data-property="size_options"]').value,x=document.getElementById("tmpl-edit-image-modal").content.cloneNode(!0);(t=r.querySelector("header")).after(x.querySelector("#image-modal-content")),r.querySelector(".widget-modal-main").append(x.querySelector("footer")),r.style.width="85%",r.style.height="85%",t.querySelector(".widget-modal-headings").style.padding="0 0.5em 0 0.75em",t.querySelector("#widget-modal-title h2").textContent=IMAGE_WIDGET.image_details,r.querySelector("#image-modal-content").dataset.widgetId=e.id,r.querySelector(".widget-modal-left-sidebar").classList.add("hidden"),n(),a=r.querySelector("#image-details-size"),i=r.querySelector("#image-details-link-to"),d=r.querySelector("#image-details-link-to-custom"),o=r.querySelector("#edit-original"),l=r.querySelector("#image-details-size-width"),u=r.querySelector("#image-details-size-height"),c=r.querySelector("#media-button-update"),s=a.closest("fieldset").querySelector(".custom-size"),a.insertAdjacentHTML("afterbegin",I),"custom"===m?(l.value=p,u.value=y,s.classList.remove("hidden")):(s.classList.add("hidden"),l.value="",u.value=""),0==E?(o.parentNode.setAttribute("hidden",!0),o.parentNode.setAttribute("inert",!0)):a.querySelector('option[value="'+m+'"]').setAttribute("selected",!0),a.addEventListener("change",(function(){var e=a.options[a.selectedIndex];a.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected")})),e.setAttribute("selected",!0),"custom"===e.value?(s.classList.remove("hidden"),l.value=p,u.value=y):(s.classList.add("hidden"),l.value="",u.value=""),c.removeAttribute("disabled")})),i.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected"),e.value===b&&e.setAttribute("selected",!0)})),"none"!==b?(d.parentNode.style.display="block","file"===b||"post"===b?d.value=_:"custom"===b&&(d.value=h)):(i.value="none",d.parentNode.style.display="none",d.value=""),r.querySelector("#image-details-alt-text").value=v,r.querySelector("#image-details-caption").value=g,r.querySelector("#image-details-title-attribute").value=w,r.querySelector("#image-details-css-class").value=S,r.querySelector("#image-details-link-target").value=f,r.querySelector("#image-details-link-rel").value=A,r.querySelector("#image-details-link-css-class").value=q,r.querySelector(".column-image img").src=_,null!=o&&(o.setAttribute("data-href",o.dataset.href.replace("item=xxx","item="+E)),o.setAttribute("data-widget-id",e.id)),r.showModal(),i.addEventListener("change",(function(){var e=this[this.selectedIndex];i.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected")})),e.setAttribute("selected",!0),"none"===e.value?(d.parentNode.style.display="none",d.value=""):("file"===e.value||"post"===e.value?d.value=_:"custom"===e.value&&(d.value=h),d.parentNode.style.display="block"),c.removeAttribute("disabled")})),r.querySelectorAll("#image-modal-content textarea, #image-modal-content input").forEach((function(e){e.addEventListener("change",(function(){c.removeAttribute("disabled")}))}))}(T)):"edit-original"===s.target.id?function(e){var t,a=document.querySelector("#"+e+' [data-property="attachment_id"]').value,i=document.querySelector("#"+e+" .edit-media").dataset.editNonce;(t=new FormData).append("action","image-editor"),t.append("_ajax_nonce",i),t.append("postid",a),t.append("do","rotate-cw"),fetch(ajaxurl,{method:"POST",body:t,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(t){r.querySelector(".media-embed").style.display="none",r.querySelector(".modal-image-details").insertAdjacentHTML("beforeend",t.data.html),r.querySelector(".imgedit-cancel-btn").addEventListener("click",(function(){r.querySelector(".media-embed").style.display=""})),r.querySelector(".imgedit-submit-btn").addEventListener("click",(function(){document.getElementById(e).dispatchEvent(new Event("change")),u()}))}))["catch"]((function(e){console.error("Error:",e)}))}(s.target.dataset.widgetId):"widget-modal-close"===s.target.id&&u(),"media-button-update"===s.target.id?function(e){var t=r.querySelector("#image-details-size"),a=t.options[t.selectedIndex].text,i=document.getElementById(e);i.querySelector('[data-property="alt"]').value=r.querySelector("#image-details-alt-text").value,i.querySelector('[data-property="caption"]').value=r.querySelector("#image-details-caption").value,i.querySelector('[data-property="size"]').value=t.value,i.querySelector('[data-property="link_image_title"]').value=r.querySelector("#image-details-title-attribute").value,i.querySelector('[data-property="link_type"]').value=r.querySelector("#image-details-link-to").value,i.querySelector('[data-property="link_url"]').value=r.querySelector("#image-details-link-to-custom").value,i.querySelector('[data-property="image_classes"]').value=r.querySelector("#image-details-css-class").value,i.querySelector('[data-property="link_target_blank"]').value=r.querySelector("#image-details-link-target").checked?"_blank":"",i.querySelector('[data-property="link_rel"]').value=r.querySelector("#image-details-link-rel").value,i.querySelector('[data-property="link_classes"]').value=r.querySelector("#image-details-link-css-class").value,"custom"===t.value?(i.querySelector('[data-property="width"]').value=r.querySelector("#image-details-size-width").value,i.querySelector('[data-property="height"]').value=r.querySelector("#image-details-size-height").value):(i.querySelector('[data-property="width"]').value=parseInt(a.split(" \u2013 ")[1]),i.querySelector('[data-property="height"]').value=parseInt(a.split(" x ")[1])),r.close(),r.querySelector("#image-modal-content").remove(),r.querySelector(".widget-modal-footer").remove(),document.body.className.includes("widgets-php")&&i.classList.add("widget-dirty"),i.querySelector(".widget-control-save").textContent=IMAGE_WIDGET.save,i.dispatchEvent(new Event("change")),i.querySelector(".widget-control-save").disabled=!1}(r.querySelector("#edit-original").dataset.widgetId):r.querySelector("#widget-modal-media-content")&&(m=r.querySelector("#widget-modal-media-content").dataset.widgetId,(c=(p=document.getElementById(m)).querySelector(".id_base"))&&"media_image"===c.value&&(y=r.querySelector("#menu-item-add"),g=r.querySelector("#menu-item-embed"),v=r.querySelector("#menu-item-browse"),b=r.querySelector("#menu-item-upload"),h=r.querySelector("#media-library-grid"),f=r.querySelector(".widget-modal-right-sidebar"),w=r.querySelector(".widget-modal-pages"),S=r.querySelector("#uploader-inline"),q=r.querySelector("#insert-from-url-panel"),A=r.querySelector(".widget-modal-header-buttons"),"pagination-links"===s.target.parentNode.className&&"BUTTON"===s.target.tagName?o(p,s.target.dataset.page):s.target.parentNode.parentNode&&"pagination-links"===s.target.parentNode.parentNode.className&&"BUTTON"===s.target.parentNode.tagName?o(p,s.target.parentNode.dataset.page):"menu-item-embed"===s.target.id?(r.querySelector("h2").textContent=IMAGE_WIDGET.insert_from_url,y.classList.remove("active"),y.setAttribute("aria-selected",!1),v.classList.remove("active"),v.setAttribute("aria-selected",!1),b.classList.remove("active"),b.setAttribute("aria-selected",!1),s.target.classList.add("active"),s.target.setAttribute("aria-selected",!0),A.style.display="none",S.setAttribute("hidden",!0),S.setAttribute("inert",!0),h.setAttribute("hidden",!0),h.setAttribute("inert",!0),f.setAttribute("hidden",!0),q.removeAttribute("hidden"),q.removeAttribute("inert"),function(){var t=r.querySelector("#widget-modal-embed-url-field"),a=r.querySelector("#widget-modal-media-content").dataset.widgetId,i=document.getElementById(a),d=i.querySelector('[data-property="link_type"]').value,o=i.querySelector('[data-property="url"]').value,n=r.querySelector("#embed-image-settings-alt-text"),u=r.querySelector("#embed-image-settings-caption"),s=r.querySelector("#link-to"),c=r.querySelector("#embed-image-settings-link-to-custom");t.value=o,""!==o&&l(o),t.addEventListener("change",(function(t){var a=t.target.value,i=r.querySelector("#message");a!==o?(e.removeAttribute("disabled"),l(a)):(i&&i.remove(),e.setAttribute("disabled",!0),a===o&&l(o))})),n.addEventListener("change",(function(){i.querySelector('[data-property="alt"]').value=n.value,e.removeAttribute("disabled")})),u.addEventListener("change",(function(){i.querySelector('[data-property="caption"]').value=u.value,e.removeAttribute("disabled")})),d?(s.querySelectorAll("option").forEach((function(e){e.value===d&&e.setAttribute("selected","selected")})),"none"===d||null==i.querySelector('[data-property="link_url"]')?(c.parentNode.setAttribute("hidden",!0),c.value=""):(c.value=i.querySelector('[data-property="link_url"]').value,c.parentNode.removeAttribute("hidden"))):(s.value="none",c.value=""),s.addEventListener("change",(function(){var t=this[this.selectedIndex];s.querySelectorAll("option").forEach((function(e){e.removeAttribute("selected")})),t.setAttribute("selected",!0),"none"===t.value?(c.parentNode.setAttribute("hidden",!0),c.value=""):c.parentNode.removeAttribute("hidden"),e.removeAttribute("disabled")})),c.addEventListener("change",(function(){e.removeAttribute("disabled")}))}()):"menu-item-add"===s.target.id?(r.querySelector("h2").textContent=IMAGE_WIDGET.media_library,g.classList.remove("active"),g.setAttribute("aria-selected",!1),b.classList.remove("active"),b.setAttribute("aria-selected",!1),v.classList.remove("active"),v.setAttribute("aria-selected",!1),q.setAttribute("hidden",!0),q.setAttribute("inert",!0),r.querySelector(".widget-modal-media-embed .thumbnail img")&&r.querySelector(".widget-modal-media-embed .thumbnail img").remove(),A.style.display="flex",h.removeAttribute("hidden"),h.removeAttribute("inert"),f.removeAttribute("hidden"),r.querySelector("#menu-item-browse").click()):"menu-item-browse"===s.target.id?(b.classList.remove("active"),b.setAttribute("aria-selected",!1),y.classList.add("active"),y.setAttribute("aria-selected",!0),g.classList.remove("active"),g.setAttribute("aria-selected",!1),s.target.classList.add("active"),s.target.setAttribute("aria-selected",!0),S.setAttribute("hidden",!0),S.setAttribute("inert",!0),h.removeAttribute("hidden"),h.removeAttribute("inert"),f.removeAttribute("hidden"),f.removeAttribute("inert"),w.removeAttribute("hidden"),w.removeAttribute("inert")):"menu-item-upload"===s.target.id?(v.classList.remove("active"),v.setAttribute("aria-selected",!1),y.classList.remove("active"),y.setAttribute("aria-selected",!1),g.classList.remove("active"),g.setAttribute("aria-selected",!1),s.target.classList.add("active"),s.target.setAttribute("aria-selected",!0),S.removeAttribute("hidden"),S.removeAttribute("inert"),h.setAttribute("hidden",!0),h.setAttribute("inert",!0),f.setAttribute("hidden",!0),f.setAttribute("inert",!0),w.setAttribute("hidden",!0),w.setAttribute("inert",!0),function(e){a.registerPlugin(FilePondPluginFileValidateSize,FilePondPluginFileValidateType,FilePondPluginFileRename,FilePondPluginImagePreview),t=a.create(r.querySelector("#filepond"),{allowMultiple:!0,server:{process:function(e,t,a,r,i,d,o){var l=new FormData;return l.append("async-upload",t,t.name),l.append("action","upload-attachment"),l.append("_wpnonce",document.getElementById("_wpnonce").value),fetch(ajaxurl,{method:"POST",body:l,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){e.success?r("finished"):i(IMAGE_WIDGET.upload_failed)}))["catch"]((function(e){i(IMAGE_WIDGET.upload_failed),console.error(IMAGE_WIDGET.error,e)})),{abort:function(){o()}}},maxFileSize:r.querySelector("#ajax-url").dataset.maxFileSize},onprocessfile:(e,a)=>{e||(setTimeout((function(){t.removeFile(a.id)}),100),function(){var e,t=document.querySelectorAll(".media-item"),a=document.querySelector(".displaying-num").textContent.split(" "),r=document.querySelector(".load-more-count").textContent.split(" ");t.forEach((function(e,t){e.setAttribute("data-order",parseInt(t+1))})),e=5 in r?" "+r[5]:"";document.querySelector(".load-more-count").textContent=r[0]+" "+t.length+" "+r[2]+" "+t.length+" "+r[4]+e,document.querySelector(".displaying-num").textContent=t.length+" "+a[1]}())},onprocessfiles:()=>{o(document.getElementById(e),1),r.querySelector("#menu-item-browse").click(),setTimeout((function(){r.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0)}),500)},labelTapToUndo:IMAGE_WIDGET.tap_close,fileRenameFunction:e=>new Promise((function(t){t(window.prompt(IMAGE_WIDGET.new_filename,e.name))})),acceptedFileTypes:document.querySelector(".uploader-inline").dataset.allowedMimes.split(","),labelFileTypeNotAllowed:IMAGE_WIDGET.invalid_type,fileValidateTypeLabelExpectedTypes:IMAGE_WIDGET.check_types})}(m)):"media-button-insert"===s.target.id?function(e){var t,a,i,d,o="",l="",n="",s=e.querySelector(".media-widget-preview"),c=document.createElement("fieldset"),m=document.createElement("fieldset"),p=e.querySelector(".multi_number").value;if(r.querySelector("#insert-from-url-panel").hasAttribute("hidden")){if(!r.querySelector("#media-library-grid").hasAttribute("hidden")){for(var y in n=(d=r.querySelector(".widget-modal-grid .selected")).dataset.editNonce,t=d.querySelector("img"),i=JSON.parse(d.dataset.sizes))o+='<option value="'+y+'">'+y[0].toUpperCase()+y.slice(1)+" \u2013 "+i[y].width+" x "+i[y].height+"</option>";l=r.querySelector(".link-to-custom").value,e.querySelector('[data-property="attachment_id"]').value=d.dataset.id,e.querySelector('[data-property="alt"]').value=r.querySelector("#attachment-details-alt-text").textContent,e.querySelector('[data-property="caption"]').value=r.querySelector("#attachment-details-caption").textContent,e.querySelector('[data-property="url"]').value=d.dataset.url,e.querySelector('[data-property="size"]').value=r.querySelector(".size").value,e.querySelector('[data-property="link_type"]').value=r.querySelector(".link-to").value,e.querySelector('[data-property="size_options"]').value=o}}else a=r.querySelector("#widget-modal-embed-url-field").value,(t=document.createElement("img")).src=a,t.setAttribute("draggable",!1),t.alt=r.querySelector("#embed-image-settings-alt-text").value,""===t.alt&&t.setAttribute("aria-label",IMAGE_WIDGET.aria_label+a.split("/").pop()),t.onload=function(){e.querySelector('[data-property="width"]').value=t.width,e.querySelector('[data-property="height"]').value=t.height},l=r.querySelector("#embed-image-settings-link-to-custom").value,e.querySelector('[data-property="url"]').value=a,e.querySelector('[data-property="attachment_id"]').value=0,e.querySelector('[data-property="alt"]').value=r.querySelector("#embed-image-settings-alt-text").value,e.querySelector('[data-property="caption"]').value=r.querySelector("#embed-image-settings-caption").value,e.querySelector('[data-property="link_type"]').value=r.querySelector("#link-to").value?r.querySelector("#link-to").value:"none";c.className="media-widget-buttons",c.innerHTML='<button type="button" class="button edit-media" data-edit-nonce="'+n+'">'+IMAGE_WIDGET.edit_image+'</button><button type="button" class="button change-media select-media">'+IMAGE_WIDGET.replace_image+"</button>",m.className="media-widget-image-link",m.innerHTML='<label for="widget-media_image-'+p+'-link_url">Link to:</label><input id="widget-media_image-'+p+'-link_url" name="widget-media_image['+p+'][link_url]" class="widefat" type="url" value="'+l+'" placeholder="https://" data-property="link_url">',t.className="attachment-thumb",null!==e.querySelector(".attachment-media-view")?(s.prepend(t),s.classList.add("populated"),e.querySelector(".attachment-media-view").remove(),s.after(c),c.after(m)):e.querySelector(".attachment-thumb").replaceWith(t),document.body.className.includes("widgets-php")&&e.classList.add("widget-dirty"),e.querySelector(".widget-control-save").textContent=IMAGE_WIDGET.save,e.dispatchEvent(new Event("change")),e.querySelector(".widget-control-save").disabled=!1,u()}(p):s.target.className.includes("delete-attachment")?p.querySelector('[data-property="attachment_id"]')&&r.querySelector(".widget-modal-grid .selected").dataset.id!=p.querySelector('[data-property="attachment_id"]').value&&window.confirm(IMAGE_WIDGET.confirm_delete)&&(k=r.querySelector(".widget-modal-grid .selected").dataset.id,N=new URLSearchParams({action:"delete-post",_ajax_nonce:document.getElementById("media-"+k).dataset.deleteNonce,id:k}),fetch(ajaxurl,{method:"POST",body:N,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){1===e?u():console.log(IMAGE_WIDGET.delete_failed)}))["catch"]((function(e){console.error(IMAGE_WIDGET.error,e)}))):s.target.className.includes("copy-attachment-url")&&(E=s.target,I=r.querySelector("#attachment-details-copy-link").value,x=document.createElement("input"),navigator.clipboard?navigator.clipboard.writeText(I):(document.body.append(x),x.value=I,x.select(),document.execCommand("copy")),clearTimeout(_),E.nextElementSibling.classList.remove("hidden"),x.remove(),_=setTimeout((function(){E.nextElementSibling.classList.add("hidden")}),3e3),wp.a11y.speak(wp.i18n.__("The file URL has been copied to your clipboard")))))})),r.addEventListener("change",(function(e){var t,a,i;r.querySelector("#widget-modal-media-content")&&(t=r.querySelector("#widget-modal-media-content").dataset.widgetId,(i=(a=document.getElementById(t)).querySelector(".id_base"))&&"media_image"===i.value?"filter-by-date"===e.target.id||"postform"===e.target.className?o(a,1):"current-page-selector"===e.target.id?o(a,e.target.value):"widget-modal-search-input"===e.target.id&&(o(a,1),r.querySelector(".widget-modal-right-sidebar-info").setAttribute("hidden",!0)):r.querySelector("#image-modal-content")&&(t=r.querySelector("#image-modal-content").dataset.widgetId))})),r.addEventListener("keydown",(function(e){var t,a,i,d,o=r.querySelector("#media-widget-modal"),l="select";o&&(r.querySelector("#image-modal-content")?(l="edit",t=r.querySelector("#image-modal-content").dataset.widgetId):t=r.querySelector("#widget-modal-media-content").dataset.widgetId,t&&(a=document.getElementById(t),i=a.querySelector("details"),(d=a.querySelector(".id_base"))&&"media_image"===d.value&&r.open&&"Escape"===e.key&&(u(),setTimeout((function(){i.open=!0}),100),i.addEventListener("toggle",(function(e){e.target.open&&("edit"===l?a.querySelector(".edit-media").focus():a.querySelector(".select-media").focus())})))))}))}));